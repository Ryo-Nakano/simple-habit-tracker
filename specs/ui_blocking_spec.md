# UI操作ブロック機能 仕様書

## 1. 概要
タスクの更新、新規作成、削除、およびログの更新（チェックボックス操作）を行う際、GAS側へのリクエストが完了するまでの間、画面操作をブロックする機能を実装する。
これにより、短期間の連続リクエストによるデータの不整合や、DB（スプレッドシート）とフロントエンドの表示ズレを防ぐ。

## 2. 対象となる操作
以下の操作実行時にブロック処理を適用する。

1.  **タスク新規作成** (`addTask`)
2.  **タスク編集・更新** (`updateTask`)
3.  **タスク削除** (`deleteTask`)
4.  **ログ記録（チェックボックス ON/OFF）** (`toggleLog`)

## 3. 実装仕様

### 3.1 画面挙動
- 上記「対象となる操作」が開始された直後から、GASからのレスポンス（成功/失敗）が返ってくるまでの間、画面全体に対してユーザー操作（クリック、タップ、入力など）を無効化する。
- ユーザーには「処理中」であることがわかる視覚的フィードバック（ローディングインジケータ等）を表示する。

### 3.2 技術的アプローチ
- `App.tsx` にアプリケーション全体の `isProcessing` ステートを導入する。
- ローディング用のオーバーレイコンポーネント（`LoadingOverlay`）を作成し、`isProcessing` が `true` の場合に表示する。
- 各操作ハンドラ（`handleAddTask` など）の処理開始時に `isProcessing(true)`、終了時（`finally` ブロック）に `isProcessing(false)` をセットする。

## 4. 検討事項（確認したい点）

### 4.1 楽観的更新 (Optimistic UI) の扱いについて
**決定事項: 案A（楽観的更新を維持しつつブロック）を採用**
- チェックボックス等の操作をした瞬間にUIは更新される（楽観的更新）。
- 同時に画面全体をブロックし、サーバー通信完了まで次の操作を防ぐ。
- 万が一エラーが発生した場合は、ブロック解除後にロールバック（元の状態に戻す）を行う。

### 4.2 ローディングの表示レベル
**要件:**
- ユーザーの操作が不可能になること。
- 「現在は処理中である」ということがユーザーに伝わること。
- 実装: 画面全体を覆う半透明のオーバーレイ ＋ スピナー（または「処理中...」等のテキスト）を表示する。
